@model Twitter.Models.ApplicationUser

@{
    ViewBag.Title = "Profile";
    bool isOwner = Model.UserName == User.Identity.Name;
    bool showFollow = Model.Followers.FirstOrDefault(u => u.UserName == User.Identity.Name) == null;
}

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span3">
            <div class="well">
                <ul class="nav nav-list">
                    @if (isOwner)
                    {
                        <li>
                            @Ajax.ActionLink("New Tweet", "Create", "Tweets", null, new AjaxOptions()
                        {
                            HttpMethod = "GET",
                            UpdateTargetId = "action-result-container",
                            InsertionMode = InsertionMode.Replace
                        })
                        </li>
                        <li>
                            @Ajax.ActionLink("Change Avatar", "ChangeAvatar", "Users", null, new AjaxOptions()
                        {
                            HttpMethod = "GET",
                            UpdateTargetId = "action-result-container",
                            InsertionMode = InsertionMode.Replace
                        })
                        </li>
                    }
                    <li>
                        @Ajax.ActionLink("My Tweets", "Tweets", new { username = Model.UserName }, new AjaxOptions()
                    {
                        HttpMethod = "GET",
                        UpdateTargetId = "action-result-container",
                        InsertionMode = InsertionMode.Replace
                    })
                    </li>
                    <li>
                        @Ajax.ActionLink("Favorites", "Favorites", new { username = Model.UserName }, new AjaxOptions()
                    {
                        HttpMethod = "GET",
                        UpdateTargetId = "action-result-container",
                        InsertionMode = InsertionMode.Replace
                    })
                    </li>
                    <li>
                        @Ajax.ActionLink("Followers", "Followers", new { username = Model.UserName }, new AjaxOptions()
                    {
                        HttpMethod = "GET",
                        UpdateTargetId = "action-result-container",
                        InsertionMode = InsertionMode.Replace
                    })
                    </li>
                    <li>
                        @Ajax.ActionLink("Following", "Following", new { username = Model.UserName }, new AjaxOptions()
                    {
                        HttpMethod = "GET",
                        UpdateTargetId = "action-result-container",
                        InsertionMode = InsertionMode.Replace
                    })
                    </li>
                </ul>
            </div>
        </div>
        <div class="span9">
            <div class="well">
                <div class="row-fluid">
                    <div class="span4"></div>
                    <div class="span6">
                        <img src="@Model.ProfilePicture" width="73" height="73" alt="Alternate Text" />
                        <strong>@Html.ActionLink(@Model.FullName, "Profile", "Users", new { username = Model.UserName }, null)</strong>
                        <span>&nbsp;@@@Model.UserName</span>
                    </div>
                </div>
                <div class="row-fluid">&nbsp;</div>
                <div class="row-fluid">
                    <div class="span4"></div>
                    <div class="span1"><span><span class="badge badge-success">@Model.Tweets.Count</span> Tweets</span></div>
                    <div class="span1"><span><span class="badge badge-success">@Model.Following.Count</span> Following</span></div>
                    <div class="span1"><span><span class="badge badge-success">@Model.Followers.Count</span> Followers</span></div>
                    <div class="span1"></div>
                    @if (!isOwner && showFollow)
                    {
                        <div class="span2">
                            @using (Html.BeginForm("Follow", "Users"))
                            {
                                @Html.AntiForgeryToken()
                                @Html.Hidden("username", Model.UserName);
                                <input type="submit" value="Follow me" class="btn btn-success" />
                            }
                        </div>
                    }
                    else if (!isOwner)
                    {
                        <div class="span2">
                            @using (Html.BeginForm("StopFollowing", "Users"))
                            {
                                @Html.AntiForgeryToken()
                                @Html.Hidden("username", Model.UserName);
                                <input type="submit" value="Stop Following" class="btn btn-danger" />
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div id="action-result-container" class="well">
                @Html.Partial("_ListTweets", Model.Tweets)
            </div>
        </div>
    </div>
</div>
<script>
    function onProgress(ev) {
        $(".progress.bar").css("width", ev.percentComplete);
        console.log(ev.percentComplete);
    }
</script>